{% include 'bankheader.html' %}
<center>
		<div class="fullwidthbanner" id="home">
            <div class="tp-banner">
                <ul>
                    <!-- SLIDE 1 -->
                    <li data-transition="fade" data-slotamount="7" data-masterspeed="1500">
                        <!-- MAIN IMAGE -->
                        <img src="/static/images/bg-1.jpg" alt="desk" data-bgfit="cover" data-bgposition="left top" data-bgrepeat="no-repeat">
                        <!-- LAYERS -->
                        <!-- LAYER NR. 1 -->
                        <div class="tp-caption slider-title" data-x="center" data-y="center"  data-voffset="-30" data-speed="500" data-start="1200" data-easing="Power4.easeInOut">
<h1 style="padding-top: 100px">Accounts Request</h1>
<input
  type="text"
  id="nameSearch"
  class="form-control"
  placeholder="Search by Customer Name"
  style="width: 250px; display: inline-block; margin-bottom: 10px; font-size: 13px;">

<input
  type="text"
  id="pincodeSearch"
  class="form-control"
  placeholder="Search by Pincode"
  style="width: 200px; display: inline-block; margin-left: 10px; margin-bottom: 10px; font-size: 13px;">

<select
  id="statusFilter"
  class="form-control"
  style="width: 180px; display: inline-block; margin-left: 10px; margin-bottom: 10px; font-size: 13px;">
  <option value="all">All Statuses</option>
  <option value="accepted">Accepted</option>
  <option value="rejected">Rejected</option>
  <option value="pending">Pending</option>
</select>

<table class="table" style="width: 500px;font-size:12px">

	<tr>
		<th>Customer Name</th>
		<th>HouseName</th>
		<th>Customer Place</th>
		<th>Pincode</th>
		<th>Phone</th>
		<th>Email</th>
		<th>Date</th>
		<th>Status</th>
	</tr>
	{% for row in data['account'] %}
	<tr>
		<td>{{row['firstname']+" "+row['lastname']}}</td>
		<td>{{row['housename']}}</td>
		<td>{{row['place']}}</td>
		<td>{{row['pincode']}}</td>
		<td>{{row['phone']}}</td>
		<td>{{row['email']}}</td>
		<td>{{row['datetime']}}</td>
		{% if row['status']=='pending' %}
		<td><a class="btn btn-success" href="?action=accept&id={{row['account_id']}}">Accept</a></td>
		<td><a class="btn btn-info" href="?action=reject&id={{row['account_id']}}">Reject</a></td>
		{% else %}
		<td>{{row['status']}}</td>
		{% endif %}
	</tr>
	{% endfor %}
</table>
</center>
                        </div> <!-- /tp-caption -->
                        <!-- LAYER NR. 2 -->
                       
                    </li>
                    <!-- SLIDE 2 -->
                    
                </ul>
            </div>
        </div><!--full width banner-->

{% include 'footer.html' %}

<script>
  const nameSearch = document.getElementById('nameSearch');
  const pincodeSearch = document.getElementById('pincodeSearch');
  const statusFilter = document.getElementById('statusFilter');
  const rows = document.querySelectorAll('table.table tr');

  function filterTable() {
    const nameText = nameSearch.value.toLowerCase();
    const pincodeText = pincodeSearch.value.toLowerCase();
    const statusText = statusFilter.value.toLowerCase();

    for (let i = 1; i < rows.length; i++) { // skip header row
      const row = rows[i];
      const cells = row.getElementsByTagName('td');

      const customerName = cells[0]?.innerText.toLowerCase(); // Customer Name
      const pincode = cells[3]?.innerText.toLowerCase();      // Pincode
      const statusCellText = cells[cells.length - 1]?.innerText.toLowerCase(); // Last column Status text
      
      // For rows with Accept/Reject buttons, status might not be in last cell text,
      // so check if there are buttons, if yes get from buttons' href or fallback.
      let status = statusCellText;

      // If last cell contains buttons (Accept/Reject), infer status from href action:
      if (cells.length > 7 && (cells[cells.length - 1].querySelector('a.btn-success') || cells[cells.length - 1].querySelector('a.btn-info'))) {
        // Pending status if buttons shown
        status = 'pending';
      }

      const matchesName = customerName.includes(nameText);
      const matchesPincode = pincode.includes(pincodeText);
      const matchesStatus = statusText === 'all' || status === statusText;

      row.style.display = (matchesName && matchesPincode && matchesStatus) ? '' : 'none';
    }
  }

  nameSearch.addEventListener('keyup', filterTable);
  pincodeSearch.addEventListener('keyup', filterTable);
  statusFilter.addEventListener('change', filterTable);
</script>
